<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>FKK27｜構造評価｜by adjustment-field</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <meta name="theme-color" content="#00b386">
  <link rel="manifest" href="manifest.json">
  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("service-worker.js");
    });
  }
  </script>
  <style>
    :root{
      --bg:#f8faf9;
      --card:#ffffff;
      --accent:#007b9e;
      --accent-soft:#d6ecf5;
      --text:#1a1a1a;
      --muted:#666;
      --line:rgba(0,0,0,0.08);
      --ok:#0a8f5a;
      --warn:#c47f00;
      --danger:#e45757;
      font-family:"Noto Sans JP",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      line-height:1.7;
      -webkit-text-size-adjust:100%;
    }
    header{
      padding:20px 16px 8px;
      text-align:center;
    }
    header h1{
      margin:0 0 6px;
      font-size:1.2rem;
      font-weight:600;
    }
    header p{
      margin:0;
      font-size:0.8rem;
      color:var(--muted);
    }
    main{
      max-width:520px;
      margin:0 auto 32px;
      padding:0 12px 24px;
    }
    .card{
      background:var(--card);
      border-radius:12px;
      padding:16px 16px 18px;
      box-shadow:0 2px 4px rgba(0,0,0,0.04);
      border:1px solid var(--line);
      margin-bottom:14px;
    }
    .card h2{
      margin:0 0 8px;
      font-size:1rem;
      font-weight:600;
    }
    .lead{
      font-size:0.8rem;
      color:var(--muted);
      margin:0 0 10px;
    }
    .btn-column{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:4px;
    }
    button{
      border-radius:999px;
      border:none;
      padding:12px 16px;
      font-size:0.95rem;
      font-weight:600;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      white-space:nowrap;
    }
    .btn-primary{
      background:var(--accent);
      color:#ffffff;
    }
    .btn-outline{
      background:transparent;
      color:var(--accent);
      border:1px solid var(--accent-soft);
    }
    button:active{
      opacity:0.85;
      transform:translateY(1px);
    }
    .stat-row{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:8px;
      margin-top:4px;
    }
    .stat-label{
      font-size:0.8rem;
      color:var(--muted);
    }
    .stat-value{
      font-size:1.3rem;
      font-weight:700;
    }
    .stat-value.ok{color:var(--ok);}
    .stat-value.warn{color:var(--warn);}
    .stat-value.bad{color:var(--danger);}
    .stat-detail{
      font-size:0.75rem;
      color:var(--muted);
      margin-top:6px;
    }
    .days-list{
      list-style:none;
      padding:0;
      margin:6px 0 0;
      font-size:0.75rem;
      color:var(--muted);
      max-height:120px;
      overflow-y:auto;
    }
    .days-list li{
      padding:2px 0;
      border-bottom:1px dashed var(--line);
    }
    .days-list li:last-child{
      border-bottom:none;
    }
    footer{
      text-align:center;
      font-size:0.68rem;
      color:var(--muted);
      padding:4px 0 14px;
    }
    @media (min-width:720px){
      header h1{font-size:1.3rem;}
    }
  </style>
</head>
<body>
  <header>
    <h1>FKK27｜構造評価｜by adjustment-field</h1>
    <p>捕手×中軸のための「0）構造チェック」と月10回メニュー達成をサポートするホーム画面。</p>
  </header>
  <main>
    <section class="card">
      <h2>今日やること</h2>
      <p class="lead">
        まずは 0）構造評価で「体の土台」をチェック。<br>
        そのうえで、いつものトレーニングメニューに進みます。
      </p>
      <div class="btn-column">
        <button type="button" class="btn-primary" onclick="goStructure()">
          0）構造評価をする（足底・胸郭・OHS）
        </button>
        <button type="button" class="btn-outline" onclick="goMenu()">
          今日のメニュー画面へ進む
        </button>
      </div>
    </section>
<section class="card">
  <h2>今月のメニュー達成状況</h2>
  <p class="lead">
    同じメニューを「月10回」実施できれば、その月は構造づくりの量として100％達成とみなします。
  </p>

  <div class="stat-row">
    <div class="stat-label" id="monthLabel">今月の達成率</div>
    <div id="monthPercent" class="stat-value bad">0%</div>
  </div>
  <p id="monthDetail" class="stat-detail">
    今月はまだメニュー実施が記録されていません。
  </p>

  <p class="stat-label" style="margin-top:10px;">今月の実施日</p>
  <ul id="menuDaysList" class="days-list">
    <li>まだ記録されていません。</li>
  </ul>

  <!-- ★★★ 追加：記録リセットボタン ★★★ -->
 <div class="btn-column" style="margin-top:16px;"> 
<button type="button" class="btn-outline" onclick="resetRecords()">記録をリセットする</button>
  </div>

</section>  </main>
   
  <footer>
    FKK27捕手のための構造評価＆メニュー管理アプリ。ブラウザのローカル保存のみを使用し、個人端末内で完結します。
  </footer>
  <script>
    (function(){
      const monthLabel = document.getElementById("monthLabel");
      const monthPercent = document.getElementById("monthPercent");
      const monthDetail = document.getElementById("monthDetail");
      const menuDaysList = document.getElementById("menuDaysList");

      const STORAGE_KEY = "fkk27_structural_and_menu_v1";
      let appData = loadData();

      function loadData(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(!raw){
            return { checks: [], menuLogs: [] };
          }
          const parsed = JSON.parse(raw);
          if(Array.isArray(parsed)){
            return { checks: parsed, menuLogs: [] };
          }
          return {
            checks: Array.isArray(parsed.checks) ? parsed.checks : [],
            menuLogs: Array.isArray(parsed.menuLogs) ? parsed.menuLogs : []
          };
        }catch(e){
          console.error("loadData error", e);
          return { checks: [], menuLogs: [] };
        }
      }

      function updateMonthlyStats(){
        const now = new Date();
        const y = now.getFullYear();
        const m = now.getMonth() + 1;
        const ymStr = y + "-" + ("0"+m).slice(-2);

        const logs = Array.isArray(appData.menuLogs) ? appData.menuLogs : [];
        const daysThisMonth = [];
        let count = 0;

        logs.forEach(dStr=>{
          if(typeof dStr !== "string"){ return; }
          if(dStr.slice(0,7) === ymStr){
            count++;
            daysThisMonth.push(dStr);
          }
        });

        const rawPercent = (count/10)*100;
        const percent = rawPercent >= 100 ? 100 : Math.round(rawPercent);

        monthLabel.textContent = ymStr + " の達成率";
        monthPercent.textContent = percent + "%";
        monthPercent.classList.remove("ok","warn","bad");

        if(percent >= 100){
          monthPercent.classList.add("ok");
          monthDetail.textContent = "今月は目標の10回をクリア（" + count + "回）。構造づくりの量は十分です。質の調整に集中できます。";
        }else if(percent >= 80){
          monthPercent.classList.add("ok");
          monthDetail.textContent = "今月は " + count + " / 10回。かなり良いペースです。あと少しで100％達成。";
        }else if(percent >= 50){
          monthPercent.classList.add("warn");
          monthDetail.textContent = "今月は " + count + " / 10回。悪くないですが、構造定着にはもう数回積み重ねたいゾーンです。";
        }else if(count > 0){
          monthPercent.classList.add("bad");
          monthDetail.textContent = "今月は " + count + " / 10回。まずはメニューに触れる回数を増やすことを優先しましょう。";
        }else{
          monthPercent.classList.add("bad");
          monthDetail.textContent = "今月はまだメニュー実施が記録されていません。まずは1回目をクリアするところから。";
        }

        renderMenuDays(daysThisMonth);
      }

      function renderMenuDays(days){
        menuDaysList.innerHTML = "";
        if(!days.length){
          const li = document.createElement("li");
          li.textContent = "まだ記録されていません。";
          menuDaysList.appendChild(li);
          return;
        }
        const sorted = days.slice().sort();
        sorted.forEach(dStr=>{
          const li = document.createElement("li");
          li.textContent = dStr + "：メニュー実施";
          menuDaysList.appendChild(li);
        });
      }
 /* ★★★ 追加：リセット機能 ★★★ */
 window.resetRecords = function(){ 
if(confirm("記録をすべてリセットしますか？\n（今月の達成率・実施日も消えます）")){
     localStorage.removeItem(STORAGE_KEY);
     location.reload();
   }
 };

      window.goStructure = function(){
        window.location.href = "structure.html";
      };

      window.goMenu = function(){
        window.location.href = "menu.html";
      };

      updateMonthlyStats();
    })();
  </script>
</body>
</html>
