<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>0）構造評価｜FKK27</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<meta name="theme-color" content="#007b9e">
<link rel="manifest" href="manifest.json">
<style>
:root{
  --bg:#f8faf9;
  --card:#fff;
  --accent:#007b9e;
  --accent-soft:#d6ecf5;
  --text:#1a1a1a;
  --muted:#666;
  --line:rgba(0,0,0,0.08);
  font-family:"Noto Sans JP",system-ui,sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;background:var(--bg);color:var(--text);line-height:1.7;}
header{text-align:center;padding:20px 16px 8px;}
header h1{margin:0 0 6px;font-size:1.1rem;font-weight:600;}
header p{margin:0;font-size:0.8rem;color:var(--muted);}
main{max-width:520px;margin:0 auto 24px;padding:0 12px;}
.card{
  background:var(--card);border-radius:12px;
  padding:16px;border:1px solid var(--line);margin-bottom:14px;
}
.card h2{margin:0 0 12px;font-size:1rem;font-weight:600;}
.criteria-box{
  background:#fff;border-radius:8px;padding:10px;border:1px solid var(--line);
  margin-bottom:16px;
}
.criteria-box label{display:block;font-size:0.85rem;margin:2px 0;}
.slider-block{margin-bottom:24px;}
.slider-label{font-size:0.9rem;font-weight:600;margin-bottom:4px;}
.score-value{font-size:0.95rem;font-weight:700;color:var(--accent);margin-left:6px;}
input[type=range]{width:100%;margin:10px 0 6px;}
.criteria{
  font-size:0.75rem;color:var(--muted);background:#f0f7fa;
  padding:8px 10px;border-radius:8px;border-left:3px solid var(--accent);
  white-space:pre-line;line-height:1.4;
}
button{
  width:100%;padding:12px 16px;border:none;border-radius:999px;
  font-size:1rem;font-weight:600;background:var(--accent);color:#fff;
  cursor:pointer;margin-top:10px;
}
button:active{opacity:0.85;transform:translateY(1px);}
.history-title{font-size:0.85rem;margin:6px 0 4px;color:var(--muted);}
.history-list{
  list-style:none;padding:0;margin:0;max-height:160px;overflow-y:auto;
  font-size:0.75rem;
}
.history-list li{
  border-bottom:1px dashed var(--line);padding:4px 0;
}
.back-btn{
  display:block;margin-top:16px;padding:10px 14px;text-align:center;
  border-radius:999px;border:1px solid var(--accent-soft);
  color:var(--accent);background:#fff;font-size:0.9rem;font-weight:600;
  text-decoration:none;
}
</style>
</head>
<body>
<header>
  <h1>0）構造評価｜FKK27</h1>
  <p>選手自身がセルフチェックできるよう明確な評価基準を設定しています。</p>
</header>
<main>
<section class="card">
  <h2>今日の構造スコア</h2>
  <div class="criteria-box">
    <div class="slider-label">
      ① 足底（横アーチ支点） <span id="s1v" class="score-value">0</span>
    </div>
    <label><input type="checkbox" name="s1" value="0">0：つま先 or かかとに逃げる</label>
    <label><input type="checkbox" name="s1" value="1">1：途中だけ支点が出る</label>
    <label><input type="checkbox" name="s1" value="2">2：大半で支点が成立</label>
    <label><input type="checkbox" name="s1" value="3">3：荷物を持っても揺るがない</label>
  </div>
  <div class="slider-block">
    <div class="slider-label">② 胸郭（肋骨と肩甲帯の分離） <span id="s2v" class="score-value">0</span></div>
    <input id="s2" type="range" min="0" max="3" value="0">
    <div class="criteria">
0：反りで誤魔化す  
1：少しだけ分離  
2：自然に分離  
3：肋骨→肩甲帯の入れ替えが自在  
    </div>
  </div>
  <div class="slider-block">
    <div class="slider-label">③ OHS（オーバーヘッドスクワット） <span id="s3v" class="score-value">0</span></div>
    <input id="s3" type="range" min="0" max="3" value="0">
    <div class="criteria">
0：バーが前に倒れる  
1：ギリ成立  
2：耳ラインで安定  
3：滑らか・左右差なし  
    </div>
  </div>
  <button onclick="saveScore()">今日の構造スコアを保存</button>
</section>
<section class="card">
  <h2>構造チェック履歴</h2>
  <p class="history-title">直近の記録</p>
  <ul id="historyList" class="history-list">
    <li>まだ記録がありません。</li>
  </ul>
</section>
<a class="back-btn" href="index.html">← ホームに戻る</a>
</main>
<script>
(function(){
  const STORAGE_KEY="fkk27_structural_and_menu_v1";

  function load(){
    try{
      const raw=localStorage.getItem(STORAGE_KEY);
      if(!raw) return{checks:[],menuLogs:[]};
      const p=JSON.parse(raw);
      return{
        checks:Array.isArray(p.checks)?p.checks:[],
        menuLogs:Array.isArray(p.menuLogs)?p.menuLogs:[]
      };
    }catch(e){return{checks:[],menuLogs:[]};}
  }

  let appData=load();

  const s1v=document.getElementById("s1v");
  const s2v=document.getElementById("s2v");
  const s3v=document.getElementById("s3v");

  document.getElementById("s2").oninput=function(){s2v.textContent=this.value;};
  document.getElementById("s3").oninput=function(){s3v.textContent=this.value;};

  window.saveScore=function(){
    const now=new Date();
    const d=now.getFullYear()+"-"+("0"+(now.getMonth()+1)).slice(-2)+"-"+("0"+now.getDate()).slice(-2);

    const entry={
      date:d,
      s1:getMax("s1"),
      s2:Number(document.getElementById("s2").value),
      s3:Number(document.getElementById("s3").value)
    };

    appData.checks.push(entry);
    localStorage.setItem(STORAGE_KEY,JSON.stringify(appData));
    render();
    alert("保存しました");
  };

  function render(){
    const box=document.getElementById("historyList");
    box.innerHTML="";
    if(!appData.checks.length){
      const li=document.createElement("li");
      li.textContent="まだ記録がありません。";
      box.appendChild(li);
      return;
    }
    appData.checks.slice().reverse().slice(0,30).forEach(rec=>{
      const li=document.createElement("li");
      li.textContent=
        rec.date+
        " ｜ 足底:"+rec.s1+
        " / 胸郭:"+rec.s2+
        " / OHS:"+rec.s3;
      box.appendChild(li);
    });
  }

  render();
})();

function getMax(name){
  const boxes=document.querySelectorAll('input[name="'+name+'"]:checked');
  let max=0;
  boxes.forEach(b=>{
    const v=Number(b.value);
    if(v>max) max=v;
  });
  return max;
}

document.querySelectorAll("input[type=checkbox]").forEach(b=>{
  b.addEventListener("change",()=>{
    document.getElementById("s1v").textContent=getMax("s1");
  });
});
</script>
</body>
</html>

